#!/bin/sh

BASE=$PWD

mkdcd(){
	[ -d $1 ] || mkdir $1
	cd $1
}

mkdcd ${DSTMPDIR:=./tmp}

[ -f $BASE/.venv/bin/activate ] && . $BASE/.venv/bin/activate

[ $# -ne 0 ] && python $BASE/dynastyscraper.py "$@" >wget.sh

parallel -j64 <wget.sh			# 64 should be harmless.

[ -z "$NOZIP" ] && for f in ./*; do
	[ -d "$f" ] &&
		echo "zip \"$(echo $f |tr ' ' '_').cbz\" \"$f\"/*"
done |parallel

[ -n "$DSRMDIR" ] && find . -maxdepth 1 \( ! -name . ! -name .. \) -type d -exec rm -rf {} \;
